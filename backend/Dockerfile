FROM python:3.11-slim-bullseye

RUN apt update && apt upgrade -y

WORKDIR /usr/src/django_back

ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1

RUN pip install --upgrade pip

COPY .env /usr/src/django_back/

COPY ./requirements.txt /usr/src/django_back/

RUN pip install -r requirements.txt

RUN set -o allexport; source /usr/src/django_back/.env; set +o allexport

ENV SECRET_KEY=$SECRET_KEY
ENV POSTGRES_ENGINE=$POSTGRES_ENGINE
ENV POSTGRES_DB=$POSTGRES_DB
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD
ENV POSTGRES_HOST=$POSTGRES_HOST
ENV POSTGRES_PORT=$POSTGRES_PORT
ENV ALLOWED_HOSTS=$ALLOWED_HOSTS
ENV DEBUG=$DEBUG
ENV HELICONE_API_KEY=$HELICONE_API_KEY
ENV AZURE_OPENAI_API_KEY=$AZURE_OPENAI_API_KEY
ENV AZURE_TRANSLATE_API_KEY=$AZURE_TRANSLATE_API_KEY
ENV OPENAI_KEY=$OPENAI_KEY
ENV MAIN_MCC_ID=$MAIN_MCC_ID
